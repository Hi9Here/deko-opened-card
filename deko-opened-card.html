<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<!--
  `deko-card`
  @demo demo/index.html
-->

<dom-module id="deko-opened-card">
  <style>
    :host {font-size: 20px;}
  </style>
  <template>
    <div style="min-height: 95vh; margin: 20px" inner-h-t-m-l="[[theHtml]]"></div>
  </template>
</dom-module>
<script>
  Polymer({
    is: "deko-opened-card",
    properties:{
      // This is what is displayed before it is used.
      card:Object,
      // edit
      edit: {
        type: Boolean,
        value: false,
      },
      pillar: {
        value: {},
      },
      profile:{
        type: Object,
        value: {}
      },
      theHtml: {
        computed:"_getHtml(card,edit,pillar, deck)"
      },
    },
    _getHtml: function(card, edit, pillar, deck){
      var output
      if (card._output) {
        output = card._output + ""
        for (var attr in card) {
          if (attr !== "_data" || attr !== "_output") {
            //replace {{}}
            re = new RegExp("{{"+attr+"}}", "gim")
            output = output.replace(re, card[attr])
          }
        }
      } else {
        var outputType
        if (card.outputType) {
          outputType = card.outputType
        } else if (card.cardType) {
          outputType = card.cardType
        } else {
          outputType = "link-display"  
        }
        var outputContent
        if (card.content) {
          outputContent = card.content
        } else {
          outputContent = ""
        }
        var outAttrs = ""
        if (Object.keys(pillar)) {
          outAttrs = " opened pillar='" + JSON.stringify(pillar) + "' " 
        } else {
          outAttrs = " opened "
        }   
        if (edit) {
          outAttrs = outAttrs + " edit "
        }
        for (var attr in card) {
          if (attr !== "_data" || attr !== "output") {
            //replace {{}}
            re = new RegExp("{{"+attr+"}}", "gim")
            var theString
            if (typeof card[attr] === 'object') {
              theString =  JSON.stringify(card[attr] )
            } else {
              theString = card[attr] + ""
            }
            outputContent = outputContent.replace(re, card[attr] )
            if (attr ) {
            }
            outAttrs = outAttrs + " " + attr.split("_").join("") + "='" + theString + "' " 
          }
        }
        output = "<"+ outputType + outAttrs + " >" + outputContent + "</"+ outputType + ">"
      }
      return output
    },
    _openEdit : function() {
      if (this.card) {
        this.fire("edit", this.card)
      }
    }
  })
</script>
